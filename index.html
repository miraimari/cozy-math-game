<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Game with Avatars</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    .screen { display: none; padding: 20px; }
    .active { display: block; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; border-radius: 8px; cursor: pointer; }
    #keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; justify-items: center; margin-top: 10px; }
    #keypad button { width: 80px; height: 60px; font-size: 20px; border-radius: 8px; }
    #avatarGrid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
    #avatarGrid img { width: 100px; height: 100px; object-fit: cover; border-radius: 12px; cursor: pointer; border: 3px solid transparent; }
    #avatarGrid img.selected { border: 3px solid green; }
    .avatar-small { width: 50px; height: 50px; border-radius: 8px; vertical-align: middle; }
  </style>
</head>
<body>

  <!-- Load Screen -->
  <div id="loadScreen" class="screen active">
    <h1>Welcome to Math Game</h1>
    <input id="usernameInput" placeholder="Enter your name" />
    <br><br>
    <div id="avatarDisplay"></div>
    <br>
    <button onclick="startGame()">Start Game</button>
    <button onclick="showSettings()">Settings</button>
    <button onclick="showTopScores()">Top Scores</button>
    <button onclick="showAvatarScreen()">Avatar</button>
    <p id="streakInfo"></p>
    <p id="dailyScoreInfo"></p>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen" class="screen">
    <h2 id="question"></h2>
    <input id="answer" readonly />
    <div id="keypad"></div>
    <p id="feedback"></p>
    <p id="scoreDisplay"></p>
    <button onclick="exitGame()">Exit Game</button>
  </div>

  <!-- Settings Screen -->
  <div id="settingsScreen" class="screen">
    <h2>Settings</h2>
    <button onclick="backToLoad()">Back</button>
  </div>

  <!-- Top Scores Screen -->
  <div id="scoresScreen" class="screen">
    <h2>Top Scores</h2>
    <div id="scoresList"></div>
    <button onclick="backToLoad()">Back</button>
  </div>

  <!-- Avatar Screen -->
  <div id="avatarScreen" class="screen">
    <h2>Choose Your Avatar</h2>
    <div id="avatarGrid">
      <!-- Example placeholders (replace with your own images in /images/) -->
      <img src="images/cat.png" onclick="selectAvatar('images/cat.png')" />
      <img src="images/turtle.png" onclick="selectAvatar('images/turtle.png')" />
      <img src="images/dragon.png" onclick="selectAvatar('images/dragon.png')" />
      <img src="images/axolotl.png" onclick="selectAvatar('images/axolotl.png')" />
      <img src="images/bunny.png" onclick="selectAvatar('images/bunny.png')" />
      <img src="images/dog.png" onclick="selectAvatar('images/dog.png')" />
    </div>
    <br>
    <button onclick="backToLoad()">Back</button>
  </div>

<script>
  let currentScreen = "loadScreen";
  let currentUser = "";
  let gameScore = 0;
  let dailyScore = 0;
  let streak = 0;
  let lastPlayedDate = "";

  function switchScreen(id) {
    document.getElementById(currentScreen).classList.remove("active");
    document.getElementById(id).classList.add("active");
    currentScreen = id;
    if (id === "loadScreen") updateLoadScreen();
  }

  function startGame() {
    currentUser = document.getElementById("usernameInput").value.trim();
    if (!currentUser) { alert("Enter a name first!"); return; }
    gameScore = 0;
    document.getElementById("scoreDisplay").textContent = "Score: 0";
    generateQuestion();
    switchScreen("gameScreen");
  }

  function exitGame() {
    saveScores();
    switchScreen("loadScreen");
  }

  function showSettings() { switchScreen("settingsScreen"); }
  function showTopScores() { renderScores(); switchScreen("scoresScreen"); }
  function showAvatarScreen() { switchScreen("avatarScreen"); }
  function backToLoad() { switchScreen("loadScreen"); }

  // --- Question logic ---
  function generateQuestion() {
    let a = Math.floor(Math.random() * 10);
    let b = Math.floor(Math.random() * 10);
    document.getElementById("question").textContent = `${a} + ${b} = ?`;
    document.getElementById("answer").value = "";
    document.getElementById("feedback").textContent = "";
    document.getElementById("answer").dataset.correct = a + b;
  }

  function checkAnswer() {
    let input = document.getElementById("answer").value;
    let correct = document.getElementById("answer").dataset.correct;
    if (parseInt(input) === parseInt(correct)) {
      gameScore++;
      dailyScore++;
      document.getElementById("feedback").textContent = `✅ Correct, ${currentUser}!`;
      document.getElementById("scoreDisplay").textContent = `Score: ${gameScore}`;
      saveScores();
      setTimeout(generateQuestion, 2000);
    } else {
      document.getElementById("feedback").textContent = "❌ Try again!";
    }
  }

  // --- Keypad ---
  function buildKeypad() {
    const keys = ["1","2","3","4","5","6","7","8","9","0","Clear","Submit"];
    let html = "";
    keys.forEach(k => {
      if (k === "Clear") {
        html += `<button onclick="document.getElementById('answer').value=''">Clear</button>`;
      } else if (k === "Submit") {
        html += `<button onclick="checkAnswer()">Submit</button>`;
      } else {
        html += `<button onclick="document.getElementById('answer').value+= '${k}'">${k}</button>`;
      }
    });
    document.getElementById("keypad").innerHTML = html;
  }
  buildKeypad();

  // --- Avatar Selection ---
  function selectAvatar(path) {
    if (!currentUser) currentUser = document.getElementById("usernameInput").value.trim();
    if (!currentUser) { alert("Enter your name first!"); return; }
    localStorage.setItem(currentUser + "_avatar", path);
    updateLoadScreen();
    alert("Avatar selected!");
    switchScreen("loadScreen");
  }

  function updateLoadScreen() {
    let avatar = localStorage.getItem(currentUser + "_avatar");
    if (avatar) {
      document.getElementById("avatarDisplay").innerHTML = `<img src="${avatar}" class="avatar-small">`;
    } else {
      document.getElementById("avatarDisplay").innerHTML = "";
    }
    document.getElementById("streakInfo").textContent = `Streak: ${localStorage.getItem(currentUser + "_streak") || 0}`;
    document.getElementById("dailyScoreInfo").textContent = `Daily Score: ${localStorage.getItem(currentUser + "_dailyScore") || 0}`;
  }

  // --- Scores ---
  function saveScores() {
    let today = new Date().toLocaleDateString();
    let lastDate = localStorage.getItem(currentUser + "_lastDate");
    if (lastDate !== today) {
      localStorage.setItem(currentUser + "_dailyScore", 0);
    }
    localStorage.setItem(currentUser + "_score", gameScore);
    localStorage.setItem(currentUser + "_dailyScore", dailyScore);
    localStorage.setItem(currentUser + "_lastDate", today);
  }

  function renderScores() {
    let container = document.getElementById("scoresList");
    container.innerHTML = "";
    for (let i = 0; i < localStorage.length; i++) {
      let key = localStorage.key(i);
      if (key.endsWith("_score")) {
        let user = key.replace("_score","");
        let avatar = localStorage.getItem(user + "_avatar");
        let score = localStorage.getItem(user + "_score") || 0;
        let daily = localStorage.getItem(user + "_dailyScore") || 0;
        let streak = localStorage.getItem(user + "_streak") || 0;
        container.innerHTML += `
          <p>
            ${avatar ? `<img src="${avatar}" class="avatar-small">` : ""} 
            <b>${user}</b> - Score: ${score}, Daily: ${daily}, Streak: ${streak}
          </p>`;
      }
    }
  }
</script>
</body>
</html>
