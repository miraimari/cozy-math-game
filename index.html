<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cozy Math Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: pink;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .screen { display: none; padding: 20px; }
    .active { display: block; }
    button {
      margin: 5px;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 12px;
      border: none;
      background: #f1f1f1;
      cursor: pointer;
    }
    #avatarPreview img {
      width: 80px;
      height: 80px;
      border-radius: 10px;
    }
    .avatar-option {
      width: 80px;
      height: 80px;
      margin: 10px;
      border: 3px solid transparent;
      cursor: pointer;
    }
    .avatar-option.selected {
      border-color: #333;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 80%;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
    }
  </style>
</head>
<body>

  <!-- LOAD SCREEN -->
  <div id="loadScreen" class="screen active">
    <h1>üéÄ Cozy Math Game üéÄ</h1>
    <input type="text" id="playerName" placeholder="Enter your name">
    <div id="streakInfo"></div>
    <div id="avatarPreview"></div>
    <button onclick="startGame()">Start Game</button>
    <button onclick="showScreen('avatarScreen')">Select Avatar</button>
    <button onclick="showScreen('topScoresScreen')">Top Scores</button>
  </div>

  <!-- GAME SCREEN -->
  <div id="gameScreen" class="screen">
    <h2 id="greeting"></h2>
    <div id="gameAvatar"></div>
    <p id="equation"></p>
    <input type="text" id="answer" placeholder="Your answer">
    <div>
      <button onclick="checkAnswer()">Submit</button>
      <button onclick="exitGame()">Exit Game</button>
    </div>
    <p id="feedback"></p>
    <p>Game Score: <span id="gameScore">0</span></p>
    <p>Daily Score: <span id="dailyScore">0</span></p>
    <p>Streak: <span id="streakCount">0</span> days</p>
  </div>

  <!-- AVATAR SCREEN -->
  <div id="avatarScreen" class="screen">
    <h2>Select Your Avatar</h2>
    <div id="avatarChoices"></div>
    <button onclick="showScreen('loadScreen')">Back</button>
  </div>

  <!-- TOP SCORES SCREEN -->
  <div id="topScoresScreen" class="screen">
    <h2>üèÜ Top Scores üèÜ</h2>
    <table>
      <thead>
        <tr>
          <th>Player</th>
          <th>High Score</th>
          <th>Highest Streak</th>
        </tr>
      </thead>
      <tbody id="scoresTable"></tbody>
    </table>
    <button onclick="showScreen('loadScreen')">Back</button>
  </div>

<script>
let currentPlayer = null;
let currentEquation = {};
let gameScore = 0;

const avatars = [
  "https://raw.githubusercontent.com/miraimari/cozy-math-game/main/avatar1.jpg",
  "https://raw.githubusercontent.com/miraimari/cozy-math-game/main/avatar2.jpg",
  "https://raw.githubusercontent.com/miraimari/cozy-math-game/main/avatar3.jpg"
];

// Show screen
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id === "topScoresScreen") loadTopScores();
  if (id === "loadScreen") loadPlayerInfo();
}

// Load player info on load screen
function loadPlayerInfo() {
  const name = document.getElementById("playerName").value.trim();
  if (!name) return;
  let players = JSON.parse(localStorage.getItem("players") || "{}");
  if (!players[name]) return;

  const p = players[name];
  const today = new Date().toISOString().split("T")[0];
  let streakMessage = "";

  if (p.lastPlayed && p.lastPlayed < today) {
    streakMessage = "üò¢ Oh no " + name + "! You missed a day, streak reset!";
    p.streak = 0;
  } else if (p.lastPlayed === today) {
    streakMessage = "üéâ Welcome back, " + name + "! Keep going!";
  }

  players[name] = p;
  localStorage.setItem("players", JSON.stringify(players));

  document.getElementById("streakInfo").textContent = streakMessage;
  document.getElementById("avatarPreview").innerHTML = p.avatar ? `<img src="${p.avatar}">` : "";
}

// Start game
function startGame() {
  const name = document.getElementById("playerName").value.trim();
  if (!name) { alert("Enter your name!"); return; }

  let players = JSON.parse(localStorage.getItem("players") || "{}");
  if (!players[name]) {
    players[name] = { avatar: "", streak: 0, lastPlayed: "", dailyScore: 0, highestStreak: 0, highScore: 0 };
  }
  currentPlayer = name;
  localStorage.setItem("players", JSON.stringify(players));

  gameScore = 0;
  document.getElementById("gameScore").textContent = gameScore;
  document.getElementById("dailyScore").textContent = players[name].dailyScore;
  document.getElementById("streakCount").textContent = players[name].streak;
  document.getElementById("greeting").textContent = "Hi " + name + "!";
  document.getElementById("gameAvatar").innerHTML = players[name].avatar ? `<img src="${players[name].avatar}" width="80">` : "";

  newEquation();
  showScreen("gameScreen");
}

// New math equation
function newEquation() {
  let a = Math.floor(Math.random() * 10);
  let b = Math.floor(Math.random() * 10);
  currentEquation = { q: `${a} + ${b}`, ans: a + b };
  document.getElementById("equation").textContent = currentEquation.q;
  document.getElementById("answer").value = "";
}

// Check answer
function checkAnswer() {
  const ans = parseInt(document.getElementById("answer").value);
  const players = JSON.parse(localStorage.getItem("players") || "{}");
  const p = players[currentPlayer];
  const today = new Date().toISOString().split("T")[0];

  if (ans === currentEquation.ans) {
    gameScore++;
    p.dailyScore++;
    document.getElementById("feedback").textContent = "‚úÖ Correct!";
    document.getElementById("gameScore").textContent = gameScore;
    document.getElementById("dailyScore").textContent = p.dailyScore;

    // Streak update (only first correct per day)
    if (p.lastPlayed !== today) {
      p.streak++;
      document.getElementById("streakCount").textContent = p.streak;
      document.getElementById("feedback").textContent = `üéâ Awesome, ${currentPlayer}, that is correct! Your streak is now ${p.streak} days!`;
    }

    // Update highest streak & high score
    if (p.streak > p.highestStreak) p.highestStreak = p.streak;
    if (gameScore > p.highScore) p.highScore = gameScore;

    p.lastPlayed = today;
    players[currentPlayer] = p;
    localStorage.setItem("players", JSON.stringify(players));
    newEquation();
  } else {
    document.getElementById("feedback").textContent = "‚ùå Try again!";
  }
}

// Exit game
function exitGame() {
  showScreen("loadScreen");
}

// Load Top Scores
function loadTopScores() {
  const players = JSON.parse(localStorage.getItem("players") || "{}");
  let rows = "";
  for (const [name, p] of Object.entries(players)) {
    rows += `<tr>
      <td>${name}</td>
      <td>${p.highScore || 0}</td>
      <td>${p.highestStreak || 0}</td>
    </tr>`;
  }
  document.getElementById("scoresTable").innerHTML = rows;
}

// Avatar screen
function loadAvatars() {
  let html = "";
  avatars.forEach((src, i) => {
    html += `<img src="${src}" class="avatar-option" onclick="selectAvatar('${src}', this)">`;
  });
  document.getElementById("avatarChoices").innerHTML = html;
}
function selectAvatar(src, el) {
  const name = document.getElementById("playerName").value.trim();
  if (!name) { alert("Enter your name first!"); return; }

  let players = JSON.parse(localStorage.getItem("players") || "{}");
  if (!players[name]) players[name] = { avatar: "", streak: 0, lastPlayed: "", dailyScore: 0, highestStreak: 0, highScore: 0 };
  players[name].avatar = src;
  localStorage.setItem("players", JSON.stringify(players));

  document.querySelectorAll(".avatar-option").forEach(img => img.classList.remove("selected"));
  el.classList.add("selected");
  alert("Avatar selected!");
}

window.onload = loadAvatars;
</script>

</body>
</html>
